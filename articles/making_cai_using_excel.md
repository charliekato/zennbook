---
title: "Excelで四択問題CAIを作る"
emoji: "💁"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [excel, vba, cai]
published: false
---

# はじめに
MicrosoftのExcelは表計算ソフトのデファクトスタンダードですが、表計算だけでなく万能と言っても過言ではない優れたツールです。筆者はリナックス派なのですが、このExcelはリナックスにはない最強のツールと言っても良いと思っています。VBAを使えばほとんどどんなことでもできます。この記事ではTOEICのPART5のような四択問題を出題してくれるCAI(Computer Assisted Instruction)を作る方法を紹介します。
実は約20年前に出勤途上でも携帯電話でTOEICの勉強ができるようにPart5を出題してくれるサイトを立ち上げたのですが、その後off lineでも使えるようにしたいと思いこれを作ってみました。参考までにPart5を出題してくれるサイトは[ここ](http://charliek.ddns.net/Part5)です。

# 問題データを作る
まずは問題のデータベースをExcelで作ります。下の図のように一行目は見出し行にし、ID, 問題, 解説, 選択肢1, 選択肢2, 選択肢3, 選択肢4　とします。そして実際の問題を二行目から記入していきます。すべて選択肢1が正解としておきます。出題するときに選択肢をランダムに並び替えるようにしておくのでそれで問題はありません。
この作業は手作業でコツコツとするしかないと思いますが、とりあえずサンプルが必要でしたら[ここ](CAI/part5.csv)にcsvがありますので、ダウンロードしてエクセルに取り込んでください。
![](/images/CAI/questionData.jpg) 

そして、シートには適切に名前を付けておきます。例えば、"TOEIC Part5"の様につけます。
以上で問題のデータベースの作成は終了ですが、このデータを読み込んでランダムに出題するマクロを作成します。


## Visual Basicを立ち上げる
データをいれたExcelで「開発」-> 「Visual Basic」をクリック(下図)してVisul Basicの開発画面を出します。通常は「開発」のタブが表示されていないみたいですが、その場合は Alt+PF11で立ち上がると思います。もしくは「エクセル　開発タブの表示方法」でググってみてください。
![](/images/CAI/invokeVBE.jpg)
Visual Basicの開発画面が表示されたらその画面で 「挿入」-> 「標準モジュール」をクリックします。(下図)

![](/images/CAI/addModule.jpg)
すると下図の様にModule1という名前の標準モジュールができます。この Module1(コード)のタイトルのウインドウにプログラムを書いていきますが、その前にModule1では何のモジュールかわからないので名前を変更しておきます。「create_CAI」に変更する事にします。
![](/images/CAI/vbaScreen.jpg)
Visual Basicの画面のプロジェクトのウインドウでModule1を選択し、「表示」->「プロパティ ウインドウ」をクリックします。(下図)
![](/images/CAI/showProperty.jpg)
表示されたプロパティウィンドウでオブジェクト名のところのModule1をcreateCAIに変更します。(下図)
その後createCAI(コード)のウインドウでプログラムを書いていきます。


# プログラムをBASICで作成
プログラムの作成には特に順番というのはないですが、大切なのはGUIとそれ以外をしっかり区別することだと思います。VBAの場合のユーザーインターフェースは通常GUIになりますし、GUIが見栄えがいいとなんかかっこいい感じですが、プログラムで肝心なのはユーザーインターフェースではなくバックエンドつまり核になる部分です。そのGUIの部分とバックエンドをごちゃごちゃにコーディングすると訳が分からなくなります。私はGUIは通常後回しにして核の部分(バックエンド)をまず作るようにしています。
このバックエンドの部分はクラスを使ったほうがいろいろとメリットがあります。それではその核の部分を作っていきましょう。
## CAIクラスモジュールの作成
Visual Basicを立ち上げて(立ち上げ方はGoogleで検索してみてください) 挿入 -> クラスモジュールでクラスモジュールを開きます。クラスモジュールのオブジェクトの名前をCAIに変更しておきます。
メインルーチンから呼び出す可能性のない関数やサブルーチンそして本数ははprivateで定義します。そうすることで間違ってそれらが使われることが防げます。
それではこのクラスモジュールで使用する変数や定数を決めましょう。
```basic

## どの問題を出題するか
まずはどの問題を出題するかを決める関数 select_problemをつくります。
```BASIC
function select_problem() as integer
end function



